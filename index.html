<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>Opening – CNP-Catch</title>
<style>
    /* 画面を覆うステージ */
    body,html{margin:0;height:100%;overflow:hidden;background:#141414;}

    #opening-stage{
        position:relative;width:100%;height:100%;
        background:url(bg_opening.jpg) center/cover no-repeat; /* 任意 */
        overflow:hidden;
    }

    /* キャラ共通スタイル */
    .char{
        position:absolute;
        width:120px;           /* お好みで */
        pointer-events:none;   /* クリック貫通 */
        will-change:transform; /* パフォーマンス */
        animation:float linear forwards;
    }

    /* キャラが少しプカプカゆれる */
    @keyframes bob {
        0%,100%{transform:translate(-50%,-50%) translateY(0)}
        50%    {transform:translate(-50%,-50%) translateY(-8px)}
    }
    .char img{width:100%;animation:bob 3s ease-in-out infinite;}

    /* 画面端→端へ移動するメインアニメーション。JS が
       --startX / --startY / --endX / --endY を注入します。*/
    @keyframes float {
        from{transform:translate(var(--startX),var(--startY));opacity:0}
        5% {opacity:1}
        to  {transform:translate(var(--endX),var(--endY));opacity:0}
    }
</style>
</head>
<body>
<div id="opening-stage"></div>

<script>
/* --------------- ここだけ画像名をそろえて下さい ---------------- */
const charImages = [
  "Leeleeg (1).png",
  "leeleeg (1).png",
  "luna (1).png",
  "makamih (1).png",
  "makamio (1).png",
  "mitaman (1).png",
  "mitamag (1).png",
  "narukami (1).png",
  "narukamik (1).png",
  "orochi (1).png",
  "oroti (1).png",
  "runa (1).png",
  "setuna (1).png",
  "towa (1).png",
  "yama (1).png",
  "yama (2).png",
  /* ……16体まで何枚でも追加OK …… */
];

/* 1 回に表示する同時キャラ数と出現間隔 */
const CONCURRENT = 6;
const INTERVAL   = 900;   // ms

const stage = document.getElementById("opening-stage");
const stageW = () => stage.clientWidth;
const stageH = () => stage.clientHeight;

/* 方角 4 パターンの端座標を返すヘルパ */
function randomEdgePos(){
  const edge = Math.floor(Math.random()*4);   // 0:上,1:右,2:下,3:左
  switch(edge){
    case 0:return {x:Math.random()*stageW(), y:-150};              // 上
    case 1:return {x:stageW()+150,            y:Math.random()*stageH()}; // 右
    case 2:return {x:Math.random()*stageW(), y:stageH()+150};       // 下
    default:return{x:-150,                   y:Math.random()*stageH()}; // 左
  }
}

/* キャラ 1 体生成して流す */
function spawnChar(){
  /* img 要素を包む div.char を作る */
  const wrap = document.createElement("div");
  wrap.className="char";

  const img  = document.createElement("img");
  img.src = charImages[Math.floor(Math.random()*charImages.length)];
  wrap.appendChild(img);

  /* スタート/ゴール座標生成 */
  const start = randomEdgePos();
  let   end   = randomEdgePos();
  /* ゴールがスタートと同じ辺にならないよう調整 */
  while(Math.abs(start.x-end.x)<200 && Math.abs(start.y-end.y)<200){
    end = randomEdgePos();
  }

  /* カスタムプロパティでアニメーション値を注入 */
  wrap.style.setProperty("--startX", start.x+"px");
  wrap.style.setProperty("--startY", start.y+"px");
  wrap.style.setProperty("--endX",   end.x+"px");
  wrap.style.setProperty("--endY",   end.y+"px");

  /* 移動時間 (5〜9 秒) をランダムに */
  const dur = 5 + Math.random()*4;
  wrap.style.animationDuration = dur+"s";

  stage.appendChild(wrap);

  /* 終了したら要素を除去して総数を保つ */
  setTimeout(()=>wrap.remove(), dur*1000);
}

/* 一定間隔でスポーン  */
let running = 0;
setInterval(()=>{
  if(running < CONCURRENT){
    spawnChar();
    running++;
    /* 一定時間後 running カウントを戻す */
    setTimeout(()=>running--, 7000);
  }
}, INTERVAL);

/* stage をクリックでメインへ遷移 (仮) */
stage.addEventListener("click",()=>location.href="select.html");
</script>
</body>
</html>
